<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <meta name="description" content="Add a plugin to bStats.">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0"/>
    <title>bStats - Add plugin</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Space+Grotesk:wght@500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/stylesheets/main.css" />
    <script src="https://www.google.com/recaptcha/api.js" async defer></script>
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
</head>
<body>

<% include templates/navigation.ejs %>
<main class="pb-24">
    <section class="doc-hero">
        <div class="doc-container py-16 sm:py-20">
            <div class="max-w-2xl space-y-4">
                <span class="badge bg-brand-100 text-brand-700">Account</span>
                <h1 class="font-display text-4xl font-semibold tracking-tight text-slate-900 sm:text-5xl">Register a plugin</h1>
                <p class="text-base leading-relaxed text-slate-600">
                    Pick the server software, choose a display name, and we’ll generate a plugin ID. You’ll use that ID when instantiating the Metrics class.
                </p>
            </div>
        </div>
    </section>

    <section class="doc-container mt-12">
        <div class="form-card space-y-6">
            <% if (failed) { %>
            <div class="doc-callout border-rose-200 bg-rose-50 text-rose-700">Something went wrong on our side. Please try again.</div>
            <% } else if (alreadyAdded) { %>
            <div class="doc-callout border-rose-200 bg-rose-50 text-rose-700">You already added this plugin.</div>
            <% } else if (wrongCaptcha) { %>
            <div class="doc-callout border-amber-200 bg-amber-50 text-amber-700">Please solve the captcha to continue.</div>
            <% } %>

            <form method="post" class="space-y-5" id="addPluginForm">
                <div class="input-group">
                    <label class="input-label" for="software">Server software</label>
                    <select id="software" name="software" class="input-control" required>
                        <option value="" disabled selected>Select software</option>
                        <% for (var i = 0; i < allSoftware.length; i++) { %>
                        <% if (allSoftware[i].globalPlugin || (user != null && user.admin)) { %>
                        <option value="<%= allSoftware[i].id %>"><%= allSoftware[i].name %></option>
                        <% } %>
                        <% } %>
                    </select>
                </div>

                <div class="input-group">
                    <label class="input-label" for="pluginName">Plugin name</label>
                    <input id="pluginName" type="text" name="pluginName" maxlength="32"
                           pattern="^[-_a-zA-Z0-9]+(\s[-_a-zA-Z0-9]+)*$" class="input-control" placeholder="My Awesome Plugin" required>
                    <p class="form-helper">Letters, numbers, underscores. Spaces allowed between words.</p>
                </div>

                <div class="flex justify-center">
                    <div class="g-recaptcha" data-sitekey="<%= publicKey %>" data-callback="captchaSolved"></div>
                </div>

                <button id="addPluginButton" type="submit" name="btn_add_plugin" class="btn-primary w-full justify-center disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                    Add plugin
                </button>
            </form>
        </div>
    </section>
</main>

<% include templates/footer.ejs %>

<script>
    $(function () {
        const softwareSelect = $('#software');
        const pluginInput = $('#pluginName');
        const submitButton = $('#addPluginButton');
        let captchaComplete = false;

        function validateForm() {
            const softwareSelected = softwareSelect.val();
            const nameValid = pluginInput[0].checkValidity();
            submitButton.prop('disabled', !(softwareSelected && nameValid && captchaComplete));
        }

        softwareSelect.on('change', validateForm);
        pluginInput.on('input', validateForm);

        window.captchaSolved = function () {
            captchaComplete = true;
            validateForm();
        };

        validateForm();
    });
</script>

<% include templates/globalScripts.ejs %>

</body>
</html>
